/**
 * Module dependencies
 */

var should = require('should');
var path = require('path');
var Controllers = require('../lib/controllers');
var util = require('util');

/**
 * Tests
 */

describe('Controllers', function() {
  var appDir = path.join(__dirname, 'testdir');
  var app = {
    get: function(key) {
      switch(key) {
        case 'appDir':
          return appDir;
          break;
      }
    }
  }
  var controllers = new Controllers(app);
  
  describe('.buildList()', function() {
    it('should build list correctly', function(done) {
      require.extensions['.controller.js'] = require.extensions['.js'];
      controllers.buildList(function(list) {
        
        var expected = {
          '/dir/subdir/controller': {
            foo: 'foo'
          },
          '/dir/file': {
            foo: 'foo',
            bar: 'bar'
          },
          '/dir': {
            bar: 'bar'
          },
          '/with_extension': {
            baz: 'baz'
          }
        }
        
        should.deepEqual(list, expected);
        
        delete require.extensions['.controller.js'];
        done();
      });
    });
  });
});